<!-- build time:Thu Aug 24 2023 16:13:59 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="乌弥的小屋" href="https://www.umi.homes/rss.xml"><link rel="alternate" type="application/atom+xml" title="乌弥的小屋" href="https://www.umi.homes/atom.xml"><link rel="alternate" type="application/json" title="乌弥的小屋" href="https://www.umi.homes/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="MyBatis,学习笔记"><link rel="canonical" href="https://www.umi.homes/posts/58bb/"><title>MyBatis 学习笔记 - 学习笔记 - 编程学习 | Umi's Blog = 乌弥的小屋 = 等待和希望，人类的智慧就包含在这两个词中</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MyBatis 学习笔记</h1><div class="meta"><span class="item" title="创建时间：2023-08-20 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-08-20T00:00:00+08:00">2023-08-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>39k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>35 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Umi's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://cdn.staticaly.com/gh/umitsurumi/image-hosting@master/cover/mybatis.3xav3tarxk1s.webp"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 24 150 28" preserveaspectratio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/coding/" itemprop="item" rel="index" title="分类于 编程学习"><span itemprop="name">编程学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/coding/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="item" rel="index" title="分类于 学习笔记"><span itemprop="name">学习笔记</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.umi.homes/posts/58bb/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Umi"><meta itemprop="description" content="等待和希望，人类的智慧就包含在这两个词中, 乌弥的个人博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="乌弥的小屋"></span><div class="body md" itemprop="articleBody"><h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2><p>MyBatis 是一款优秀的持久层框架，它最初是 Apache 的一个开源项目名为 iBatis，这一词来源于 internet 和<br>abatis 的组合。2010 年 6 月这个项目由 Apache Software Foundation 迁移到了 Google Code。随着开发团队转投<br>Google Code 旗下， iBatis3.x 正式更名为 MyBatis。代码于 2013 年 11 月迁移到 Github。</p><p>特点：</p><ul><li>MyBatis 支持定制化 SQL、存储过程以及高级映射；</li><li>MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及结果集解析操作；</li><li>Mybatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO (Plain Old Java<br>Object，普通老式 Java 对象) 为数据库中的记录；</li><li>Mybatis 是一个轻量级，半自动的 ORM（Object Relation Mapping）框架。</li></ul><p>对比：</p><ul><li>JDBC：<ul><li>SQL 语句夹杂在 Java 代码中，耦合度高，硬编码不利于 SQL 语句修改</li><li>代码冗长，开发效率低，但是运行效率较高</li></ul></li><li>Hibernate：<ul><li>内部自动生成 SQL 语句，不利于进行特殊优化，部分长难 SQL 需要绕过框架</li><li>全映射的自动框架，操作简单，开发效率高，但是反射操作较多，导致性能下降</li></ul></li><li>MyBatis：<ul><li>SQL 语句与 Java 编码分开，功能边界清晰</li><li>轻量级半自动框架，开发效率较 Hibernate 低</li></ul></li></ul><h2 id="基本使用"><a class="markdownIt-Anchor" href="#基本使用">#</a> 基本使用</h2><h3 id="环境搭建"><a class="markdownIt-Anchor" href="#环境搭建">#</a> 环境搭建</h3><h4 id="新建-maven-项目"><a class="markdownIt-Anchor" href="#新建-maven-项目">#</a> 新建 Maven 项目</h4><p>引入 MyBatis 最简单的方法是使用 Maven 来搭建项目，并在 Maven 的 <code>pom.xml</code> 文件中引入相关依赖：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- pom.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">&lt;!-- 引入 mybatis 依赖包 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">&lt;!-- 引入 mysql 驱动，连接 mysql 数据库 --></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">&lt;!-- 引入 lombok 依赖包，简化 pojo 类编写 --></span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">&lt;!-- 引入 junit 依赖包，便于进行单元测试 --></span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token comment">&lt;!-- 引入 log4j2 依赖包，用于获取日志信息 --></span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.20.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="准备测试数据库"><a class="markdownIt-Anchor" href="#准备测试数据库">#</a> 准备测试数据库</h4><p>resources 目录下新建 sql 目录，用于放置数据库文件，并新建一张用户表，用于查询：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">database</span> mybatis<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">use</span> mybatis<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> t_user</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    u_id     <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    u_name   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>            <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    u_age    <span class="token keyword">int</span>                    <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">18</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    u_gender <span class="token keyword">enum</span> <span class="token punctuation">(</span><span class="token string">'MALE'</span><span class="token punctuation">,</span><span class="token string">'FEMALE'</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">'MALE'</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>resources 目录下编写 <code>dev.properties</code> 文件，用于书写连接数据库的配置。因为可能 MyBatis<br>中有不止一个数据库环境，所有增加前缀，如 <code>dev</code> 来进行区分：</p><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key attr-name">dev.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key attr-name">dev.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/mybatis</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key attr-name">dev.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key attr-name">dev.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span></pre></td></tr></table></figure><h4 id="准备-java-代码"><a class="markdownIt-Anchor" href="#准备-java-代码">#</a> 准备 Java 代码</h4><ol><li><p>编写 pojo<br>创建软件包 <code>com.example.mybatis.pojo</code> ，并编写 <code>User</code> 类：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Data</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@AllArgsConstructor</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@NoArgsConstructor</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uId<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> uName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uAge<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Gender</span> uGender<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>编写枚举类 <code>Gender</code> 表示用户性别：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     <span class="token constant">MALE</span><span class="token punctuation">,</span><span class="token constant">FEMALE</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>编写 mapper<br>创建软件包 <code>com.example.mybatis.mapper</code> ，并编写 <code>UserMapper</code> 接口：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     <span class="token keyword">int</span> <span class="token function">deleteUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>     <span class="token keyword">int</span> <span class="token function">updateUserById</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>     <span class="token class-name">User</span> <span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>MyBatis 中通过 Mapper 接口来进行数据库相关操作，Mapper 相当于 Dao 一层，但是与 Dao<br>不同的是，这里只需要提供接口而不需要提供实现类。</p></li></ol><h4 id="准备配置文件"><a class="markdownIt-Anchor" href="#准备配置文件">#</a> 准备配置文件</h4><ol><li><p>准备 MyBatis 核心配置文件<br>MyBatis 核心配置文件，或者称为 MyBatis 全局配置文件，习惯上命名为 <code>mybatis-config.xml</code> ，放在<br>src/main/resources 目录下。参考官网的简单示例如下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">&lt;!-- properties 标签引入外部属性配置文件 --></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">&lt;!-- environments 标签用于配置数据源环境 --></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">&lt;!-- environment 标签用于配置某一个具体的数据源环境 --></span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token comment">&lt;!-- 配置事务管理器 --></span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token comment">&lt;!-- 配置数据源和各项连接信息 --></span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;dev.driver&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;dev.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;dev.username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;dev.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">&lt;!-- mappers 标签中注册映射文件信息 --></span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">&lt;!-- mapper 标签用于配置一个具体的映射文件 --></span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>准备 mapper 映射配置文件<br>mapper 映射配置文件，命名应该与对应的 Mapper 接口保持一致，例如此处应为 <code>UserMapper.xml</code><br>。路径应该与全局配置文件中的注册映射位置一致，例如此处应该为 resources/mapper 路径下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">&lt;!-- mapper 是根标签，namespace 属性中书写 mapper 接口的全类名 --></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">&lt;!--  子标签名与 sql 方法保持一致，id 指定 mapper 接口中的对应方法名，标签中书写具体 sql 语句  --></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>        insert t_user(u_name,u_age,u_gender) values('john',28,'MALE')</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteUserById<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>        delete from t_user where u_id = 1</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUserById<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>        update t_user set u_name = "tom" where u_id = 1</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">&lt;!--  resultType 指定查询结果要封装的 Java 实体类，属性和列名会自动进行映射  --></span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>        select u_id uId,u_name Uname,u_age uAge,u_gender uGender from t_user where u_id = 1</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>准备 log4j2 日志配置文件<br>log4j2 是 Apache 对 log4j 进行重构后的升级版本，是现目前最优秀的 Java<br>日志框架。使用日志框架可以很方便地记录程序的运行信息，便于监控系统运行状况以及回溯系统故障。<br>log4j2 默认情况下会在 ClassPath 路径下查找 <code>log4j2.xml</code> 的配置文件，这里也将配置文件放在 resources<br>目录下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ConfigTest<span class="token punctuation">"</span></span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">monitorInterval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Console<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_OUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Console<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>这里配置了全局的 <code>debug</code> 级别日志输出，并且指定了输出路径是打印到控制台。</p></li></ol><h4 id="编写测试类"><a class="markdownIt-Anchor" href="#编写测试类">#</a> 编写测试类</h4><p>在 test/java 目录下创建软件包 <code>com.example.mybatis.test</code> ，并创建 <code>UserMapperTest</code> 测试类，此时整个项目的路径如下：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>project<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── pom.xml</pre></td></tr><tr><td data-num="3"></td><td><pre>└── src</pre></td></tr><tr><td data-num="4"></td><td><pre>    ├── main</pre></td></tr><tr><td data-num="5"></td><td><pre>    │   ├── <span class="token function">java</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    │   │   └── com</pre></td></tr><tr><td data-num="7"></td><td><pre>    │   │       └── example</pre></td></tr><tr><td data-num="8"></td><td><pre>    │   │           └── mybatis</pre></td></tr><tr><td data-num="9"></td><td><pre>    │   │               ├── mapper</pre></td></tr><tr><td data-num="10"></td><td><pre>    │   │               │   └── UserMapper.java</pre></td></tr><tr><td data-num="11"></td><td><pre>    │   │               └── pojo</pre></td></tr><tr><td data-num="12"></td><td><pre>    │   │                   ├── Gender.java</pre></td></tr><tr><td data-num="13"></td><td><pre>    │   │                   └── User.java</pre></td></tr><tr><td data-num="14"></td><td><pre>    │   └── resources</pre></td></tr><tr><td data-num="15"></td><td><pre>    │       ├── dev.properties</pre></td></tr><tr><td data-num="16"></td><td><pre>    │       ├── log4j2.xml</pre></td></tr><tr><td data-num="17"></td><td><pre>    │       ├── mapper</pre></td></tr><tr><td data-num="18"></td><td><pre>    │       │   └── UserMapper.xml</pre></td></tr><tr><td data-num="19"></td><td><pre>    │       ├── mybatis-config.xml</pre></td></tr><tr><td data-num="20"></td><td><pre>    │       └── sql</pre></td></tr><tr><td data-num="21"></td><td><pre>    │           └── t_user.sql</pre></td></tr><tr><td data-num="22"></td><td><pre>    └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        └── <span class="token function">java</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            └── com</pre></td></tr><tr><td data-num="25"></td><td><pre>                └── example</pre></td></tr><tr><td data-num="26"></td><td><pre>                    └── mybatis</pre></td></tr><tr><td data-num="27"></td><td><pre>                        └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                            └── UserMapperTest.java</pre></td></tr></table></figure><p>编写测试类 <code>UserMapperTest</code> ：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// @Log4j2 注解用于生成 log 日志</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Log4j2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// @Before 指定每次执行 @Test 测试前操作</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token annotation punctuation">@Before</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">InputStream</span> is<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token comment">// 以输入流的形式，读取 MyBatis 的全局配置文件</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      is <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 创建 SqlSessionFactoryBuilder 对象</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name">SqlSessionFactoryBuilder</span> factoryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 基于读取的 MyBatis 配置文件流，创建 SqlSessionFactory 对象</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> factoryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 使用 SqlSessionFactory 对象开启一个会话</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// @After 指定每次执行 @Test 测试后操作</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token annotation punctuation">@After</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">// 测试结束后，关闭 sqlSession</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token comment">// @Test 指定需要进行测试的方法</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">// 根据 Mapper 接口类型获取 Mapper 接口类型的对象</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 执行 mapper 接口的方法，完成对数据库的操作，这里因为 sql 语句中写死了插入的值，所以传入一个空的 user 对象就可以</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">int</span> i <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">// 配置文件中配置了事务管理，增删改操作需要提交后才能生效</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>运行测试后，可以通过日志信息看见输出结果如下：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">==</span><span class="token operator">></span>  Preparing: insert t_user<span class="token punctuation">(</span>u_name,u_age,u_gender<span class="token punctuation">)</span> values<span class="token punctuation">(</span><span class="token string">'john'</span>,28,<span class="token string">'MALE'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">==</span><span class="token operator">></span> Parameters:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">&lt;=</span><span class="token operator">=</span>    Updates: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG org.apache.ibatis.transaction.jdbc.JdbcTransaction - Committing JDBC Connection <span class="token punctuation">[</span>com.mysql.cj.jdbc.ConnectionImpl@72ba28ee<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.UserMapperTest - <span class="token number">1</span></pre></td></tr></table></figure><p>完成以上步骤，并成功运行，便搭建了一个基础的 MyBatis 项目环境。</p><h3 id="单表操作"><a class="markdownIt-Anchor" href="#单表操作">#</a> 单表操作</h3><h4 id="sql-传参"><a class="markdownIt-Anchor" href="#sql-传参">#</a> SQL 传参</h4><p>给 sql 语句传参有两种方式，一种是使用 <code>$&#123;&#125;</code> ，另一种是使用 <code>#&#123;&#125;</code> ，它们区别如下：</p><ol><li><code>$&#123;&#125;</code> 形式</li></ol><ul><li>底层使用字符串拼接，存在 sql 注入问题</li><li>灵活性较高，使用动态数据库列名或表名时只能采用此方式</li><li>示例：<br>更改 <code>UserMapper.xml</code> 中查询方法，使用 <code>$&#123;&#125;</code> 形式：<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    select u_id uId,u_name Uname,u_age uAge,u_gender uGender from t_user where u_id = $&#123;uId&#125;</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure>编写测试方法，传入查询值：<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">selectUserByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">User</span> user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>日志输出测试结果如下：<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> u_id uId,u_name Uname,u_age uAge,u_gender uGender from t_user where u_id <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">==</span><span class="token operator">></span> Parameters:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.UserMapperTest - User<span class="token punctuation">(</span>uId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">uName</span><span class="token operator">=</span>john, <span class="token assign-left variable">uAge</span><span class="token operator">=</span><span class="token number">28</span>, <span class="token assign-left variable">uGender</span><span class="token operator">=</span>MALE<span class="token punctuation">)</span></pre></td></tr></table></figure></li></ul><ol start="2"><li><code>#&#123;&#125;</code> 形式</li></ol><ul><li><p>底层使用</p></li><li><p>能防止 sql 注入，安全性较高，开发中优先考虑此方式</p></li><li><p>示例：<br>更改 <code>UserMapper.xml</code> 中查询方法，使用 <code>#&#123;&#125;</code> 形式：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    select u_id uId,u_name Uname,u_age uAge,u_gender uGender from t_user where u_id = #&#123;uId&#125;</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>测试方法与刚才完全相同，日志输出测试结果如下：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> u_id uId,u_name Uname,u_age uAge,u_gender uGender from t_user where u_id <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">==</span><span class="token operator">></span> Parameters:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.selectUserById - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.UserMapperTest - User<span class="token punctuation">(</span>uId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">uName</span><span class="token operator">=</span>john, <span class="token assign-left variable">uAge</span><span class="token operator">=</span><span class="token number">28</span>, <span class="token assign-left variable">uGender</span><span class="token operator">=</span>MALE<span class="token punctuation">)</span></pre></td></tr></table></figure><p>通过日志可看见，sql 语句经过了预处理被转换为 <code>?</code> 的形式，再进行的赋值。</p></li></ul><h4 id="数据输入"><a class="markdownIt-Anchor" href="#数据输入">#</a> 数据输入</h4><ol><li><p>单个简单类型<br>只包含一个值的类型，包括基本数据类型和它们的包装类型，字符串类型。<br>对这种类型的参数，可以在 sql 语句中使用任意命名作为占位符，通常来说会与方法中的变量保持一致。</p></li><li><p>单个复杂类型<br>包含多个值的类型，如集合、数组和实体类等。<br>对实体类型，可以使用它的字段名获取值，MyBatis 会自动调用相应的 <code>get</code> 方法来获取值：</p><ul><li>修改 <code>insert</code> 方法：<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  insert t_user(u_name,u_age,u_gender) values(#&#123;uName&#125;,#&#123;uAge&#125;,#&#123;uGender&#125;)</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li>修改测试方法：<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"ming"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token constant">MALE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">int</span> i <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li>日志打印结果：<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">==</span><span class="token operator">></span>  Preparing: insert t_user<span class="token punctuation">(</span>u_name,u_age,u_gender<span class="token punctuation">)</span> values<span class="token punctuation">(</span>?,?,?<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">==</span><span class="token operator">></span> Parameters: ming<span class="token punctuation">(</span>String<span class="token punctuation">)</span>, <span class="token number">28</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>, MALE<span class="token punctuation">(</span>String<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.UserMapper.insertUser - <span class="token operator">&lt;=</span><span class="token operator">=</span>    Updates: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG org.apache.ibatis.transaction.jdbc.JdbcTransaction - Committing JDBC Connection <span class="token punctuation">[</span>com.mysql.cj.jdbc.ConnectionImpl@2b87581<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.UserMapperTest - <span class="token number">1</span></pre></td></tr></table></figure></li></ul></li><li><p>多参数传值<br>对多个类型的参数，MyBatis 无法直接将参数与 sql 语句中的名称对应，这种情况下，如果参数较少，可以使用 <code>@Param(&quot;参数名&quot;)</code> 的注解，如果参数较多，可以考虑使用包装成 <code>map</code> 集合的方式传递。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 参数较少的情况</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 对应 xml 文件中使用 #&#123;name&#125; 和 #&#123;id&#125; 获取参数值</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">updateUserNameById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 零散参数较多的情况</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 将参数封装成 map 集合，xml 文件中使用 map 的 key 来获取对应的 value 值</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> <span class="token function">updateUserById</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> paramMap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ol><h4 id="数据输出"><a class="markdownIt-Anchor" href="#数据输出">#</a> 数据输出</h4><ol><li><p>简单类型<br>当 sql 查询返回简单类型时，可以在 xml 配置文件中，通过 <code>resultType</code> 指定返回值类型。</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserCount<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre> select count(*) from t_user;</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>对常用的数据类型，MyBatis 都设置有相应的别名和类型处理器，即使省略，也可以正确完成类型的处理。</p></li><li><p>实体类对象<br>返回实体类对象的方法相似，只需要在 <code>resultType</code> 属性中写出实体类的全限定类名。<br>对于数据库中列字段为下划线，而实体类中为小驼峰的情况，为了完成映射：</p><ul><li>可以在 sql 查询中设置别名</li><li>也可以在全局配置中通过 <code>&lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</code> 自动完成映射</li></ul><p>当返回值是多个实体类对象的 List 集合时，如 <code>selectUserAll()</code> ，返回类型为 <code>List&lt;User&gt;</code> ，此时不需要任何特殊处理，仍然和返回实体类一样设置 <code>resultType</code> 即可。</p></li><li><p>map 集合<br>对不便于封装为实体类的返回数据，可以设置 <code>resultType=&quot;map&quot;</code> 来返回 <code>map</code> 集合，但是这种方式使用情况较少，能包装成实体类时优先考虑实体类。</p></li><li><p>返回主键</p><ul><li><p>自增主键：<br>在 <code>insert</code> 标签上添加 <code>useGeneratedKeys=&quot;true&quot;</code> 并使用 <code>keyProperty</code> 指定主键的属性：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uId<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  insert t_user(u_name,u_age,u_gender) values(#&#123;uName&#125;,#&#123;uAge&#125;,#&#123;uGender&#125;);</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>非自增主键<br>非自增主键可以使用 <code>selectKey</code> 子标签来设置主键的值，然后再执行插入操作</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertTest<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyColumn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BEFORE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>       select replace(uuid(), '-', '')</pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>   insert into t_test(id,value) values (#&#123;id&#125;,#&#123;value&#125;);</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li></ul></li><li><p>ResultMap<br><code>resultMap</code> 标签可以设置属性名和字段之间的对应关系，并在之后的查询中直接引入，完成两者的映射：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- 使用 resultMap 标签指定属性和列名的映射关系 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token comment">&lt;!--  id 标签指定主键  --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token comment">&lt;!--  result 标签指定其他列  --></span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u_name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UName<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u_age<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UAge<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u_gender<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UGender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">&lt;!-- select 标签中使用 resultMap=mapId 来进行使用 --></span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>   select u_id,u_name,u_age,u_gender from t_user where u_id = $&#123;id&#125;</pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>比起 <code>resultType</code> ， <code>resultMap</code> 很多时候使用起来更为方便，在多表中可以通过它来完成多表关系的映射。</p></li></ol><h3 id="多表映射关联"><a class="markdownIt-Anchor" href="#多表映射关联">#</a> 多表映射关联</h3><p>数据库中的一张表对应一个 Java 实体类类型，当 Java 实体类之间存在关系时，意味着这多张表之间也存在关联关系，比如在学生和班级之间，一个学生对应一个班级，一个班级则对应多个学生。<br>一对一，一对多和多对一的关系，两张表就可以进行表示，而想表示两张表多对多的关系则需要用到第三张中间表。</p><h4 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作">#</a> 准备工作</h4><ul><li><p>准备 Java 对象</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Student.class</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@Data</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token annotation punctuation">@AllArgsConstructor</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token annotation punctuation">@NoArgsConstructor</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">Integer</span> stuId<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">String</span> stuName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">Integer</span> stuAge<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">Class</span> tClass<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// StuClass.class</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token annotation punctuation">@Data</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token annotation punctuation">@AllArgsConstructor</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token annotation punctuation">@NoArgsConstructor</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StuClass</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">Integer</span> stuClassId<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">String</span> stuClassName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> students<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>准备数据库</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">use</span> mydb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> t_class</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    class_id   <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    class_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">insert</span> t_class <span class="token punctuation">(</span>class_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'第一班'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'第二班'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'第三班'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> t_stu</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    stu_id   <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    stu_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    stu_age  <span class="token keyword">int</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    class_id <span class="token keyword">int</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>class_id<span class="token punctuation">)</span> <span class="token keyword">references</span> t_class <span class="token punctuation">(</span>class_id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">insert</span> t_stu <span class="token punctuation">(</span>stu_name<span class="token punctuation">,</span> stu_age<span class="token punctuation">,</span> class_id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'刘一'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'陈二'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'王五'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'孙七'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'周八'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'吴九'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'郑十'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'钱十一'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'吕十二'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token punctuation">(</span><span class="token string">'杨十三'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p>创建测试类</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">StuClassMapper</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">StudentMapper</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">StuClass</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Log4j2</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token annotation punctuation">@Log4j2</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SCMapperTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token annotation punctuation">@Before</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token annotation punctuation">@After</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>      sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>注册 mapper<br>准备好 <code>Student</code> 和 <code>StuClass</code> 的相应配置文件和持久层接口，当配置文件过多时，可以在 <code>mappers</code> 中使用 <code>package</code> 标签的 <code>name</code> 属性将指定包下的映射器文件全部进行注册：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- mybatis-config.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>当这样使用包名注册 mapper 配置文件时，需要注意文件名和文件夹的格式：</p><ul><li>Mapper 接口为 <code>UserMapper.java</code> ，配置文件需要命名为 <code>UserMapper.xml</code> 。</li><li>mapper 配置文件需要和 Mapper 接口放在同一个包下。</li><li>如果是 Maven 工程，配置文件需要放在 resources 目录下，且目录结构需要与 Mapper 接口所在的包的目录结构保持一致。</li></ul><p>比如，此时项目结构变为：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>project<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── pom.xml</pre></td></tr><tr><td data-num="3"></td><td><pre>└── src</pre></td></tr><tr><td data-num="4"></td><td><pre>    ├── main</pre></td></tr><tr><td data-num="5"></td><td><pre>    │   ├── <span class="token function">java</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    │   │   └── com</pre></td></tr><tr><td data-num="7"></td><td><pre>    │   │       └── example</pre></td></tr><tr><td data-num="8"></td><td><pre>    │   │           └── mybatis</pre></td></tr><tr><td data-num="9"></td><td><pre>    │   │               ├── mapper</pre></td></tr><tr><td data-num="10"></td><td><pre>    │   │               │   ├── StuClassMapper.java</pre></td></tr><tr><td data-num="11"></td><td><pre>    │   │               │   ├── StudentMapper.java</pre></td></tr><tr><td data-num="12"></td><td><pre>    │   │               │   └── UserMapper.java</pre></td></tr><tr><td data-num="13"></td><td><pre>    │   │               └── pojo</pre></td></tr><tr><td data-num="14"></td><td><pre>    │   │                   ├── Gender.java</pre></td></tr><tr><td data-num="15"></td><td><pre>    │   │                   ├── StuClass.java</pre></td></tr><tr><td data-num="16"></td><td><pre>    │   │                   ├── Student.java</pre></td></tr><tr><td data-num="17"></td><td><pre>    │   │                   └── User.java</pre></td></tr><tr><td data-num="18"></td><td><pre>    │   └── resources</pre></td></tr><tr><td data-num="19"></td><td><pre>    │       ├── com</pre></td></tr><tr><td data-num="20"></td><td><pre>    │       │   └── example</pre></td></tr><tr><td data-num="21"></td><td><pre>    │       │       └── mybatis</pre></td></tr><tr><td data-num="22"></td><td><pre>    │       │           └── mapper</pre></td></tr><tr><td data-num="23"></td><td><pre>    │       │               ├── StuClassMapper.xml</pre></td></tr><tr><td data-num="24"></td><td><pre>    │       │               ├── StudentMapper.xml</pre></td></tr><tr><td data-num="25"></td><td><pre>    │       │               └── UserMapper.xml</pre></td></tr><tr><td data-num="26"></td><td><pre>    │       ├── dev.properties</pre></td></tr><tr><td data-num="27"></td><td><pre>    │       ├── log4j2.xml</pre></td></tr><tr><td data-num="28"></td><td><pre>    │       ├── mybatis-config.xml</pre></td></tr><tr><td data-num="29"></td><td><pre>    │       └── sql</pre></td></tr><tr><td data-num="30"></td><td><pre>    │           ├── t_stu.sql</pre></td></tr><tr><td data-num="31"></td><td><pre>    │           └── t_user.sql</pre></td></tr><tr><td data-num="32"></td><td><pre>    └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        └── <span class="token function">java</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            └── com</pre></td></tr><tr><td data-num="35"></td><td><pre>                └── example</pre></td></tr><tr><td data-num="36"></td><td><pre>                    └── mybatis</pre></td></tr><tr><td data-num="37"></td><td><pre>                        └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                            ├── SCMapperTest.java</pre></td></tr><tr><td data-num="39"></td><td><pre>                            └── UserMapperTest.java</pre></td></tr></table></figure></li></ul><h4 id="对一的关系"><a class="markdownIt-Anchor" href="#对一的关系">#</a> 对一的关系</h4><p>在示例中，一个学生对应一个班级，因此学生对班级是一对一的关系。MyBatis 中，使用 <code>association</code> 标签来表示这种对一的关系。</p><ul><li><p>配置文件：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- StudentMapper.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper.StudentMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">&lt;!-- 使用 resultMap 设置对应关系 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStudentMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">&lt;!-- 先配置 Student 自身的属性和字段关系 --></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuAge<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_age<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">&lt;!-- association 配置对应其他类型的关系 --></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">&lt;!-- property 指定对一的属性名，javaType 配置对应类型的全限定类名 --></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClass<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.StuClass<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAllStudentWithClass<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStudentMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>    select stu_id,stu_name,stu_age,s.class_id,class_name from t_stu s join t_class c on s.class_id =</pre></td></tr><tr><td data-num="24"></td><td><pre>    c.class_id</pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>Mapper 接口：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token function">selectAllStudentWithClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>测试方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectAllStudentWithClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>log<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>日志结果：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectAllStudentWithClass - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> stu_id,stu_name,stu_age,s.class_id,class_name from t_stu s <span class="token function">join</span> t_class c on s.class_id <span class="token operator">=</span> c.class_id</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectAllStudentWithClass - <span class="token operator">==</span><span class="token operator">></span> Parameters:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectAllStudentWithClass - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">13</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>刘一, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>StuClass<span class="token punctuation">(</span>stuClassId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stuClassName</span><span class="token operator">=</span>第一班, <span class="token assign-left variable">students</span><span class="token operator">=</span>null<span class="token punctuation">))</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>陈二, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>StuClass<span class="token punctuation">(</span>stuClassId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stuClassName</span><span class="token operator">=</span>第一班, <span class="token assign-left variable">students</span><span class="token operator">=</span>null<span class="token punctuation">))</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># ... 省略其他数据 ...</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">10</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>郑十, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">17</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>StuClass<span class="token punctuation">(</span>stuClassId<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">stuClassName</span><span class="token operator">=</span>第三班, <span class="token assign-left variable">students</span><span class="token operator">=</span>null<span class="token punctuation">))</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">11</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>钱十一, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>StuClass<span class="token punctuation">(</span>stuClassId<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">stuClassName</span><span class="token operator">=</span>第三班, <span class="token assign-left variable">students</span><span class="token operator">=</span>null<span class="token punctuation">))</span></pre></td></tr></table></figure></li></ul><p>从结果可以看到，在查询出 <code>Student</code> 对象的同时，也查询出了对应的 <code>StuClass</code> 的信息。</p><h4 id="对多的关系"><a class="markdownIt-Anchor" href="#对多的关系">#</a> 对多的关系</h4><p>学生对应班级是对一的关系，反过来班级对应学生，一个班级则对应多个学生。MyBatis 中使用 <code>collection</code> 标签表示对多的关系。</p><ul><li><p>配置文件：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- StuClassMapper.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper.StuClassMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">&lt;!-- 同样使用 resultMap 进行映射配置 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStuClassMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.StuClass<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">&lt;!-- collection 配置对多的关系 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">&lt;!-- property 指定对多的属性名，ofType 指定集合中元素的类型 --></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>students<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuAge<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stu_age<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAllClassWithStudents<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStuClassMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>    select c.class_id,class_name,stu_id,stu_name,stu_age from t_class c join t_stu s on c.class_id =</pre></td></tr><tr><td data-num="23"></td><td><pre>    s.class_id;</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>Mapper 接口：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">StuClass</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StuClassMapper</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StuClass</span><span class="token punctuation">></span></span> <span class="token function">selectAllClassWithStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>测试方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token class-name">StuClassMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StuClassMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StuClass</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectAllClassWithStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>aStuClass <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 首先打印班级信息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>aStuClass<span class="token punctuation">.</span><span class="token function">getStuClassId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> aStuClass<span class="token punctuation">.</span><span class="token function">getStuClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 然后打印班级中每个学生信息</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    aStuClass<span class="token punctuation">.</span><span class="token function">getStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>log<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>日志结果：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectAllClassWithStudents - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">13</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">1</span>第一班</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>刘一, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>陈二, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>张三, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">13</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>杨十三, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">2</span>第二班</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>李四, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">17</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">5</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>王五, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>孙七, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>周八, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>吴九, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">12</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>吕十二, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">17</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">3</span>第三班</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">6</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>赵六, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">17</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">10</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>郑十, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">17</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">11</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>钱十一, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr></table></figure></li></ul><p>从结果可以看到，在查询出 <code>StuClass</code> 对象的同时，也查询出了其中包含的 <code>Student</code> 集合的信息。</p><h4 id="分步查询"><a class="markdownIt-Anchor" href="#分步查询">#</a> 分步查询</h4><p>在查询班级表时，虽然它和学生表之间相互关联，但是并不一定每一次都需要查询学生表的信息，如果没有使用其数据又进行了相关的查询，实际上是多了一次不必要的查询。因此，可以考虑将查询拆为两步，并通过懒加载的方式进行，当实体类需要使用关联的属性时，再进行查询。</p><ul><li><p>配置文件：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- StudentMapper.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">&lt;!-- 仅查询 Student 的方法，mybatis 配置中开启自动转小驼峰 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectStudentsByClassId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  select stu_id,stu_name,stu_age from t_stu where class_id = #&#123;classId&#125;;</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">&lt;!-- StuClassMapper.xml --></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">&lt;!-- 更改 collection 标签 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStuClassMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.StuClass<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuClassName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">&lt;!-- select 属性设置分步查询的 sql 片段 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">&lt;!-- column 属性设置分步查询建立关系依赖的字段 --></span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>students<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>class_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectClassById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStuClassMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>  select class_id,class_name from t_class where class_id = #&#123;classId&#125;;</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li><li><p>Mapper 接口：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// StudentMapper.class</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token function">selectStudentsByClassId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> classId<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// StuClassMapper.class</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">StuClass</span> <span class="token function">selectClassById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> classId<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p>测试方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token class-name">StuClassMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StuClassMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">StuClass</span> stuClass <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectClassById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>stuClass<span class="token punctuation">.</span><span class="token function">getStuClassId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> stuClass<span class="token punctuation">.</span><span class="token function">getStuClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  stuClass<span class="token punctuation">.</span><span class="token function">getStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>log<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>日志结果：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> class_id,class_name from t_class where class_id <span class="token operator">=</span> ?<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span> Parameters: <span class="token number">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> stu_id,stu_name,stu_age from t_stu where class_id <span class="token operator">=</span> ?<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span> Parameters: <span class="token number">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">=</span>      Total: <span class="token number">4</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">1</span>第一班</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>刘一, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>陈二, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>张三, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - Student<span class="token punctuation">(</span>stuId<span class="token operator">=</span><span class="token number">13</span>, <span class="token assign-left variable">stuName</span><span class="token operator">=</span>杨十三, <span class="token assign-left variable">stuAge</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">StuClass</span><span class="token operator">=</span>null<span class="token punctuation">)</span></pre></td></tr></table></figure><p>在日志结果可以看见，查询分别进行了两次，第一次是进行 <code>t_class</code> 表单的查询，第二次再进行的 <code>t_stu</code> 表的查询。</p></li><li><p>懒加载配置：<br>使用懒加载需要在 MyBatis 的全局配置文件中增加这一条配置：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- mybatis-config.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">&lt;!-- 开启懒加载功能 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazyLoadingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>注释测试方法 <code>stuClass.getStudents().forEach(login::info)</code> 一行，此时只使用 StuClass 的信息，开启和关闭懒加载后分别查看日志：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 开启懒加载，只执行了第一次分步查询</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> class_id,class_name from t_class where class_id <span class="token operator">=</span> ?<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span> Parameters: <span class="token number">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">1</span>第一班</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 关闭懒加载，两次分步查询均执行</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> class_id,class_name from t_class where class_id <span class="token operator">=</span> ?<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">==</span><span class="token operator">></span> Parameters: <span class="token number">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>  Preparing: <span class="token keyword">select</span> stu_id,stu_name,stu_age from t_stu where class_id <span class="token operator">=</span> ?<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span> Parameters: <span class="token number">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StudentMapper.selectStudentsByClassId - <span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">=</span>      Total: <span class="token number">4</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> DEBUG com.example.mybatis.mapper.StuClassMapper.selectClassById - <span class="token operator">&lt;=</span><span class="token operator">=</span>      Total: <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.SCMapperTest - <span class="token number">1</span>第一班</pre></td></tr></table></figure></li></ul><h3 id="其他配置"><a class="markdownIt-Anchor" href="#其他配置">#</a> 其他配置</h3><h4 id="类型别名"><a class="markdownIt-Anchor" href="#类型别名">#</a> 类型别名</h4><p>MyBatis 对 Java 中的各类型都配置了别名进行映射，而无需书写全限定类名：</p><ol><li><p>基本类型</p><table><thead><tr><th>Java 类型</th><th>类型别名</th></tr></thead><tbody><tr><td>byte</td><td>_byte</td></tr><tr><td>short</td><td>_short</td></tr><tr><td>int</td><td>_int、_integer</td></tr><tr><td>long</td><td>_long</td></tr><tr><td>float</td><td>_float</td></tr><tr><td>double</td><td>_double</td></tr><tr><td>boolean</td><td>_boolean</td></tr><tr><td>char</td><td>_char、 _character</td></tr></tbody></table></li><li><p>字符串，日期与包装类</p><table><thead><tr><th>Java 类型</th><th>类型别名</th></tr></thead><tbody><tr><td>String</td><td>string</td></tr><tr><td>Date</td><td>date</td></tr><tr><td>Byte</td><td>byte</td></tr><tr><td>Short</td><td>short</td></tr><tr><td>Integer</td><td>int、integer</td></tr><tr><td>Long</td><td>long</td></tr><tr><td>Float</td><td>float</td></tr><tr><td>Double</td><td>double</td></tr><tr><td>Boolean</td><td>boolean</td></tr><tr><td>Character</td><td>char、character</td></tr></tbody></table></li><li><p>数学与集合</p><table><thead><tr><th>Java 类型</th><th>类型别名</th></tr></thead><tbody><tr><td>BigDecimal</td><td>decimal、bigdecimal</td></tr><tr><td>BigInteger</td><td>biginteger</td></tr><tr><td>Object</td><td>object</td></tr><tr><td>Map</td><td>map</td></tr><tr><td>HashMap</td><td>hashmap</td></tr><tr><td>List</td><td>list</td></tr><tr><td>ArrayList</td><td>arraylist</td></tr><tr><td>Collection</td><td>collection</td></tr><tr><td>Iterator</td><td>iterator</td></tr></tbody></table></li></ol><p>对自定义的实体类，可以在核心配置文件中配置类型别名，配置完成后，就可以使用别名而免去书写冗长的全限定类名：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Post<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Section<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo.Tag<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>当实体类较多时，可以指定包名，MyBatis 会自动扫描这个包，搜索需要的实体类。此时这个实体类名就是它的别名，而不用书写全限定类名。书写时不区分大小写，但常用首字母大写的方式。</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- mybatis 核心配置文件 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- mapper 配置文件 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  select u_id,u_username,u_password,u_email from t_user where u_id = #&#123;uId&#125;</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="类型处理器"><a class="markdownIt-Anchor" href="#类型处理器">#</a> 类型处理器</h4><p>MyBatis 在设置预处理语句（PreparedStatement）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成<br>Java 类型。如下是 MyBatis 提供的一些内置的类型处理器：</p><table><thead><tr><th>类型处理器</th><th>Java 类型</th><th>JDBC 类型</th></tr></thead><tbody><tr><td><code>BooleanTypeHandler</code></td><td><code>java.lang.Boolean</code> , <code>boolean</code></td><td>数据库兼容的 <code>BOOLEAN</code></td></tr><tr><td><code>ByteTypeHandler</code></td><td><code>java.lang.Byte</code> , <code>byte</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>BYTE</code></td></tr><tr><td><code>ShortTypeHandler</code></td><td><code>java.lang.Short</code> , <code>short</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>SMALLINT</code></td></tr><tr><td><code>IntegerTypeHandler</code></td><td><code>java.lang.Integer</code> , <code>int</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>INTEGER</code></td></tr><tr><td><code>LongTypeHandler</code></td><td><code>java.lang.Long</code> , <code>long</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>BIGINT</code></td></tr><tr><td><code>FloatTypeHandler</code></td><td><code>java.lang.Float</code> , <code>float</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>FLOAT</code></td></tr><tr><td><code>DoubleTypeHandler</code></td><td><code>java.lang.Double</code> , <code>double</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code></td></tr><tr><td><code>BigDecimalTypeHandler</code></td><td><code>java.math.BigDecimal</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>DECIMAL</code></td></tr><tr><td><code>StringTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>CHAR</code> , <code>VARCHAR</code></td></tr></tbody></table><p>因为 JDK8 实现了全部的 JSR310 规范，MyBatis 从 3.4 开始，也提供了基于 JSR310<br>编写的各种日期时间类型处理器，而无需再进行手动注册。</p><p>当 MyBatis 的内置类型处理器无法识别的时候，可以通过 MyBatis 提供的自定义类型处理器来识别：</p><ul><li>自定义类型处理器实现 <code>org.apache.ibatis.type.TypeHandler</code><br>接口或者继承 <code>org.apache.ibatis.type.BaseTypeHandler</code> 类；</li><li>指定自定义类型处理器映射的某个 JDBC 类型；</li><li>在 MyBatis 核心配置文件中注册自定义类型处理器。</li></ul><p>如下是一个 <code>Address</code> 的类型处理器示例：</p><ol><li>创建自定义类型处理器</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@MappedTypes</span><span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 指定处理器映射的 Java 类型</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@MappedJdbcTypes</span><span class="token punctuation">(</span><span class="token class-name">JdbcType</span><span class="token punctuation">.</span><span class="token constant">VARCHAR</span><span class="token punctuation">)</span>  <span class="token comment">// 指定处理器映射的数据库类型</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressTypeHandler</span> <span class="token keyword">implements</span> <span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">/**</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   * 从 Java 程序到插入数据库的处理方案</pre></td></tr><tr><td data-num="7"></td><td><pre>   * @param ps 预编译的 SQL 语句</pre></td></tr><tr><td data-num="8"></td><td><pre>   * @param i 插入参数的位置</pre></td></tr><tr><td data-num="9"></td><td><pre>   * @param parameter 插入的参数</pre></td></tr><tr><td data-num="10"></td><td><pre>   * @param jdbcType  对应 JDBC 类型</pre></td></tr><tr><td data-num="11"></td><td><pre>   * @throws SQLException</pre></td></tr><tr><td data-num="12"></td><td><pre>   */</pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">Address</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    ps<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token comment">/**</span></pre></td></tr><tr><td data-num="20"></td><td><pre>   * 从数据库到 Java 程序中的处理方案</pre></td></tr><tr><td data-num="21"></td><td><pre>   * @param rs 数据库查询的结果集</pre></td></tr><tr><td data-num="22"></td><td><pre>   * @param columnName 结果集中指定的列名</pre></td></tr><tr><td data-num="23"></td><td><pre>   * @return address 自定义处理后的 Address 类对象</pre></td></tr><tr><td data-num="24"></td><td><pre>   * @throws SQLException</pre></td></tr><tr><td data-num="25"></td><td><pre>   */</pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">public</span> <span class="token class-name">Address</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token class-name">String</span> columnName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">// 从结果集中拿到 MyBatis 无法处理的列，并按照自定义规则处理</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resArr <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">// 返回自定义规则处理后的结果</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span>resArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">public</span> <span class="token class-name">Address</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token keyword">public</span> <span class="token class-name">Address</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">CallableStatement</span> cs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>其中， <code>Address</code> 类的定义如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Data</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@AllArgsConstructor</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@NoArgsConstructor</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">String</span> province<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">private</span> <span class="token class-name">String</span> district<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> province <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> district<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>注册自定义类型处理器</li></ol><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandlers</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandler</span> <span class="token attr-name">handler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.typehandler.AddressTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeHandlers</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>编写的测试类如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Log4j2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token annotation punctuation">@Before</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 加载 mybatis 核心配置文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">InputStream</span> is<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      is <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 获取 sqlSessionFactoryBuilder</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token class-name">SqlSessionFactoryBuilder</span> factoryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 获取 sqlSessionFactory</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> factoryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 获取 sqlSession</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token class-name">Address</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"奉贤"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token class-name">User</span> admin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"passwd"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">int</span> res <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token class-name">User</span> user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token annotation punctuation">@After</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>可以看到，在测试结果中，插入数据库和从数据库中读取的 <code>Address</code> 都通过自定义类型进行了正确的处理：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.MyBatisTest - <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.MyBatisTest - User<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">name</span><span class="token operator">=</span>admin, <span class="token assign-left variable">password</span><span class="token operator">=</span>passwd, <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">24</span>, <span class="token assign-left variable">address</span><span class="token operator">=</span>上海,上海,奉贤<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO  com.example.mybatis.test.MyBatisTest - User<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">name</span><span class="token operator">=</span>admin, <span class="token assign-left variable">password</span><span class="token operator">=</span>passwd, <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">24</span>, <span class="token assign-left variable">address</span><span class="token operator">=</span>上海,上海,奉贤<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="进阶使用"><a class="markdownIt-Anchor" href="#进阶使用">#</a> 进阶使用</h2><h3 id="动态-sol"><a class="markdownIt-Anchor" href="#动态-sol">#</a> 动态 SOL</h3><p>动态 sql 是指根据条件进行动态 sql 语句拼接，MyBatis 中提供了动态标签来进行动态 sql 的支持，免去了 JDBC 中的动态字符串拼接。常用的动态 sql 标签如下：</p><h4 id="if-和-where-标签"><a class="markdownIt-Anchor" href="#if-和-where-标签">#</a> if 和 where 标签</h4><p><code>if</code> 和 <code>where</code> 标签用于条件判断，满足条件后才会插入 <code>if</code> 标签中的 sql 语句，而 <code>where</code> 标签会格式化 <code>if</code> 标签插入的 sql 语句，去除多余的 <code>and</code> 或者 <code>or</code> ：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectStudentByDynamic<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resStudentMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    select stu_id,stu_name,stu_age from t_stu</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">&lt;!-- where 会自动去除标签体前多余的 and/or --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token comment">&lt;!-- if 标签中可以访问实体类的属性，通过 test 的判断才执行相应 sql --></span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classId != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        and class_id = #&#123;classId&#125;</pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuAge != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>        and stu_age > #&#123;stuAge&#125;</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">&lt;!--</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      两个条件都满足时，where class_id = ? and stu_age > ?</pre></td></tr><tr><td data-num="16"></td><td><pre>      只满足一个条件时，where class_id = ? 或者 where stu_age > ?</pre></td></tr><tr><td data-num="17"></td><td><pre>      当所有条件都不满足时，就不会有 where 子句</pre></td></tr><tr><td data-num="18"></td><td><pre>    --></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="set-标签"><a class="markdownIt-Anchor" href="#set-标签">#</a> set 标签</h4><p><code>set</code> 和 <code>if</code> 标签结合使用，可以通过条件来进行动态字段更新，与 <code>where</code> 标签类似，它也会自动进行格式化，去除多余的逗号：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateStudentByDynamic<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    update t_stu</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuName != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        stu_name = #&#123;stuName&#125;,</pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuAge != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        stu_age = #&#123;stuAge&#125;,</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    where stu_id = #&#123;stuId&#125;</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">&lt;!--</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      两个条件都满足时，set 子句为 set stu_name = ?, stu_age = ?</pre></td></tr><tr><td data-num="15"></td><td><pre>      只满足一个条件时，set 子句为 set stu_name = ? 或 set stu_age = ?</pre></td></tr><tr><td data-num="16"></td><td><pre>      当所有条件都不满足时，不会有 set 子句，会导致 update 语句的 sql 语法报错</pre></td></tr><tr><td data-num="17"></td><td><pre>    --></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="trim-标签"><a class="markdownIt-Anchor" href="#trim-标签">#</a> trim 标签</h4><p><code>trim</code> 标签可以替代 <code>where</code> 标签和 <code>set</code> 标签，它可以动态控制 sql 语句两端是否包含某些字符：</p><ul><li><code>prefix</code> 属性：指定整个 <code>trim</code> 标签中 sql 语句要动态添加的前缀</li><li><code>suffix</code> 属性：指定整个 <code>trim</code> 标签中 sql 语句要动态删除的前缀</li><li><code>prefixOverrides</code> 属性：指定 <code>trim</code> 标签中每条 sql 语句要动态去掉的前缀</li><li><code>suffixOverrides</code> 属性：指定 <code>trim</code> 标签中每条 sql 语句要动态去掉的后缀</li></ul><p>如上的使用 <code>where</code> 标签的动态 sql 可以更改为：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectStudentByDynamic<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resHandle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    select stu_id,stu_name,stu_age from t_stu</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>where<span class="token punctuation">"</span></span> <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classId != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        and class_id = #&#123;classId&#125;</pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuAge != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        and stu_age > #&#123;stuAge&#125;</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h4 id="choosewhenotherwise-标签"><a class="markdownIt-Anchor" href="#choosewhenotherwise-标签">#</a> choose/when/otherwise 标签</h4><p><code>choose/when/otherwise</code> 标签类似 Java 中的 <code>switch...case...default</code> 语句。<br>当满足 <code>when</code> 分支的条件时，执行 <code>when</code> 中的 sql 语句，并忽略其他的语句；当所有 <code>when</code> 分支都不满足的时候，执行 <code>otherwise</code> 中的语句。</p><h4 id="foreach-标签"><a class="markdownIt-Anchor" href="#foreach-标签">#</a> foreach 标签</h4><p><code>foreach</code> 标签用于批量操作，常用属性如：</p><ul><li><code>collection</code> 属性：要遍历的集合</li><li><code>item</code> 属性：遍历集合中的每个对象</li><li><code>separator</code> 属性：指定每个动态 sql 字符串间的分隔符</li><li><code>open</code> 属性：循环完成后，整体 sql 前面要添加的字符串</li><li><code>close</code> 属性：循环完成后，整体 sql 后面要添加的字符串</li><li><code>index</code> 属性： <code>List</code> 集合中表示索引值， <code>Map</code> 集合中表示 <code>key</code> 值</li></ul><h3 id="缓存策略"><a class="markdownIt-Anchor" href="#缓存策略">#</a> 缓存策略</h3><h4 id="缓存简介"><a class="markdownIt-Anchor" href="#缓存简介">#</a> 缓存简介</h4><p>缓存（Cache）是一种用于存储临时数据的机制，通常位于内存中。在数据库查询过程中，频繁地与数据库进行交互可能导致性能下降。为了提高查询效率并减少系统开销，可以将经常被查询的数据存放在缓存中，这样在查询时就可以直接从缓存中获取数据，而无需在数据库中进行查找。</p><p><img data-src="https://cdn.staticaly.com/gh/umitsurumi/image-hosting@master/blog-images/computerscience/java-note/mybatis.315m74o7bczk.webp" alt="缓存机制"></p><p>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制，并且可以极大地提升查询效率。MyBatis 的缓存机制定义了两级缓存，一级缓存是默认开启的，二级缓存需要手动开始和配置，通过实现 MyBatis 定义的 Cache 接口，还可以自定义二级缓存。</p><h4 id="使用缓存"><a class="markdownIt-Anchor" href="#使用缓存">#</a> 使用缓存</h4><p>一级缓存是默认开启的，而二级缓存需要在配置文件中增加 <code>cache</code> 标签：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">&lt;!-- 其他配置 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">&lt;!-- 启用二级缓存 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>实体类需要实现序列化接口：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token annotation punctuation">@Serial</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">6053350575990592925L</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>通过日志可以查询到二级缓存的缓存命中率，计算方式为： <code>缓存命中率=命中缓存数/查询总次数</code> 。</p><p>MyBatis 中，二级缓存的作用域是 <code>SqlSessionFactory</code> 级别，范围是整个 <code>Application</code> ，一级缓存是 <code>SqlSession</code> 级别，范围在一次 <code>sqlSession</code> 中。</p><p><img data-src="https://cdn.staticaly.com/gh/umitsurumi/image-hosting@master/blog-images/computerscience/java-note/mybatis2.6zudva42oakg.webp" alt="一级和二级缓存"></p><p>当开启二级缓存时，查询会先进行查询二级缓存，因为二级缓存中可能已经有其他 <code>sqlSession</code> 查询的缓存。如果二级缓存没有命中，再查询一级缓存，一级缓存也没有命中的情况下，才会再去查询数据库。</p><ul><li>一级缓存失效：<ul><li>不是同一个 <code>sqlsession</code></li><li>同一个 <code>sqlsession</code> 但查询条件发生了变化</li><li>同一个 <code>sqlsession</code> 但是两次查询期间执行了增删改或提交了事务</li><li>同一个 <code>sqlsession</code> 但是两次查询期间清空了缓存（clear 或 flush 方法）</li></ul></li></ul><p><code>sqlSession</code> 关闭之前或者提交了事务时，会将其中的数据写入二级缓存，增删该操作或者手动清理缓存同样会使二级缓存失效。</p><h4 id="ehcache"><a class="markdownIt-Anchor" href="#ehcache">#</a> EHCache</h4><p>整合 EHCache 需要先引入依赖：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.caches<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>然后在启用了二级缓存的配置文件中，更改为使用 EHCache：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">&lt;!-- 其他配置 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">&lt;!-- 使用 EHCache 缓存 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.caches.ehcache.EhcacheCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">&lt;!-- 缓存配置，可选的 --></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">&lt;!-- 缓存前后两次访问时间间隔，超过则会删除缓存 --></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timeToIdleSeconds<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3600<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">&lt;!-- 缓存的有效生命期，默认是 0., 也就是 element 存活时间无穷大 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timeToLiveSeconds<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3600<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">&lt;!-- 在内存中缓存的最大数目 --></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxEntriesLocalHeap<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">&lt;!-- 在磁盘中缓存的最大数目 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxEntriesLocalDisk<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">&lt;!-- 当内存缓存最大时，有新的缓存进入，移除缓存的策略 --></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memoryStoreEvictionPolicy<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>也可以通过 <code>ehcache.xml</code> 配置文件进行统一配置，配置文件应该在 <code>resources</code> 目录下，EHCache 会使用 <code>dafaultCache</code> 标签中指定的管理策略：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- ehcache.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://ehcache.org/ehcache.xsd<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token attr-name">updateCheck</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">&lt;!-- 定义磁盘缓存路径 --></span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/path/to/ehcache<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">&lt;!-- 默认缓存策略 --></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token attr-name">maxElementsOnDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000000<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token attr-name">diskExpiryThreadIntervalSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence</span> <span class="token attr-name">strategy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localTempSwap<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">&lt;!-- 缓存可配置属性</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      name: 缓存名称。</pre></td></tr><tr><td data-num="23"></td><td><pre>      maxElementsInMemory：缓存最大数目</pre></td></tr><tr><td data-num="24"></td><td><pre>      maxElementsOnDisk：硬盘最大缓存个数。</pre></td></tr><tr><td data-num="25"></td><td><pre>      eternal：对象是否永久有效，一但设置了，timeout 将不起作用。</pre></td></tr><tr><td data-num="26"></td><td><pre>      overflowToDisk：当系统当机时是否保存到磁盘</pre></td></tr><tr><td data-num="27"></td><td><pre>      timeToIdleSeconds：设置对象在失效前的允许闲置时间（单位：秒）。仅当 eternal=false 时使用，可选属性，默认为 0，可闲置时间无穷大。</pre></td></tr><tr><td data-num="28"></td><td><pre>      timeToLiveSeconds: 设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。仅当 eternal=false 对时使用，默认是 0.，对象存活时间无穷大。</pre></td></tr><tr><td data-num="29"></td><td><pre>      diskPersistent：是否缓存虚拟机重启期数据。</pre></td></tr><tr><td data-num="30"></td><td><pre>      diskSpoolBufferSizeMB：设置 DiskStore（磁盘缓存）的缓存区大，默认是 30MB。每个 Cache 都应该有自己的一个缓冲区。</pre></td></tr><tr><td data-num="31"></td><td><pre>      diskExpiryThreadIntervalSeconds：磁盘失效线程运行时间间隔，默认是 120 秒。</pre></td></tr><tr><td data-num="32"></td><td><pre>      clearOnFlush：内存数量最大时是否清除。</pre></td></tr><tr><td data-num="33"></td><td><pre>      memoryStoreEvictionPolicy：当达到 maxElementsInMemory 限制时，将会根据指定的策略去清理内存，可选策略有 LRU、LFU、FIFO</pre></td></tr><tr><td data-num="34"></td><td><pre>    --></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>LRU，即 Least Recently Used，意为最近最少使用或最近最久使用，在执行缓存回收时，删除近期访问数量最低的数据或删除近期闲置时间最长的数据。<br>其他淘汰策略还包括 LFU，最近最不经常使用策略，或 FIFO, 先进，先出策略等。</p><h4 id="缓存原理"><a class="markdownIt-Anchor" href="#缓存原理">#</a> 缓存原理</h4><p><code>org.apache.ibatis.cache.Cache</code> 是 MyBatis 的缓存接口，所有缓存都需要实现的顶级接口：<br><img data-src="https://cdn.staticaly.com/gh/umitsurumi/image-hosting@master/blog-images/computerscience/java-note/cache.6ttripmxub9c.webp" alt="cache接口"></p><p>在 <code>Cache</code> 中，定义了缓存操作的方法：</p><ul><li><code>putObject</code> ：将对象存入缓存</li><li><code>getObject</code> ：从缓存中取出对象</li><li><code>removeObject</code> ：从缓存中删除对象</li></ul><p><code>org.apache.ibatis.cache.impl.PerpetualCache</code> 是 MyBatis 的默认缓存，也是缓存接口的默认实现，它的本质是一个 HashMap 集合，MyBatis 的一级缓存和二级缓存都是通过 <code>PerpetualCache</code> 来操作缓存数据的。</p><ul><li>一级缓存：由 <code>BaseExecutor</code> 调用 <code>PerpetualCache</code></li><li>二级缓存：由 <code>CachingExecutor</code> 调用 <code>PerpetualCache</code> ， <code>CachingExecutor</code> 可以看作是对 <code>BaseExecutor</code> 的装饰。</li></ul><h3 id="插件机制"><a class="markdownIt-Anchor" href="#插件机制">#</a> 插件机制</h3><p>MyBatis 的四大对象指 <code>Executor</code> 、 <code>ParameterHandler</code> 、 <code>StatementHandler</code> 和 <code>ResultSetHandler</code> 。</p><ul><li><code>Executor</code> ：MyBatis 的执行器，用于执行增删改查操作</li><li><code>ParameterHandler</code> ：处理 SQL 的参数对象</li><li><code>StatementHandler</code> ：数据库的处理对象，用于执行 SQL 语句</li><li><code>ResultSetHandler</code> ：处理 SQL 的返回结果集</li></ul><p>MyBatis 执行的大致流程为：</p><ol><li><code>Executor</code> 发起 sql 执行任务；</li><li>调用 <code>StatementHandler</code> 中的 <code>prepare()</code> 方法进行 SQL 编译，然后调用 <code>parameterize()</code> 方法设置参数；</li><li>设置参数时，实际上是调用 <code>ParameterHandler</code> 中的 <code>setparameters()</code> 方法，该方法会通过 <code>typeHandler</code> 进行类型的转换；</li><li>执行 <code>query/update</code> 方法，返回的结果通过 <code>ResultHandler</code> 进行封装并返回。</li></ol><p>MyBatis 提供了插件机制，可以通过实现 <code>org.apache.ibatis.plugin.Interceptor</code> 接口，利用动态代理的方式，介入 MyBatis 四大对象中的任何一个方法执行过程中，更改 MyBatis 的一些核心行为，最常用的插件有分页插件 <span class="exturl" data-url="aHR0cHM6Ly9wYWdlaGVscGVyLmdpdGh1Yi5pby8=">PageHelper</span>。</p><h3 id="逆向工程"><a class="markdownIt-Anchor" href="#逆向工程">#</a> 逆向工程</h3><p>MyBatis 还支持逆向工程，这是一种先创建数据库，再由框架根据数据库表生成 Java 实体类、Mapper 接口和配置文件搭建工程的方式。反过来，先创建 Java 实体类，再由框架根据实体类生成数据库表，这种方式就是正向工程，如 Hibernate 框架。</p><p>MyBatis 逆向工程通过 Maven 插件实现，配置 <code>pom.xml</code> 如下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- Maven 在构建过程中相关配置 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">&lt;!-- 构建过程中用到的插件 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token comment">&lt;!-- 逆向工程的插件 --></span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-generator-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">&lt;!-- 插件的依赖 --></span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>          <span class="token comment">&lt;!-- 逆向工程的核心依赖 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-generator-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>          <span class="token comment">&lt;!-- mysql 数据库驱动 --></span></pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token comment">&lt;!-- 项目依赖中引入 MyBatis --></span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">&lt;!-- MyBatis 核心包 --></span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">&lt;!-- 其他项目依赖…… --></span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>然后在 resources 目录下新建 <code>generatorConfig.xml</code> 文件，配置逆向工程的生成设置：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- generatorConfig.xml --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">&lt;!--</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    targetRuntime: 执行生成的逆向工程的版本</pre></td></tr><tr><td data-num="10"></td><td><pre>    MyBatis3Simple: 生成基本的 CRUD</pre></td></tr><tr><td data-num="11"></td><td><pre>    MyBatis3: 生成带条件的 CRUD</pre></td></tr><tr><td data-num="12"></td><td><pre>   --></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DB2Tables<span class="token punctuation">"</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyBatis3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">&lt;!-- 数据库的连接信息 --></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/mydb<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">&lt;!-- javaBean 的生成策略 --></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.pojo<span class="token punctuation">"</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./src/main/java<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>trimStrings<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>javaModelGenerator</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">&lt;!-- 映射文件的生成策略 --></span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlMapGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper<span class="token punctuation">"</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./src/main/java<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sqlMapGenerator</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">&lt;!-- Mapper 接口的生成策略 --></span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>XMLMAPPER<span class="token punctuation">"</span></span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mybatis.mapper<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./src/main/java<span class="token punctuation">"</span></span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>javaClientGenerator</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">&lt;!-- 逆向分析的表 --></span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">&lt;!-- tableName 设置为 * 号，可以对应所有表，此时不写 domainObjectName --></span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">&lt;!-- domainObjectName 属性指定生成出来的实体类的类名 --></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t_class<span class="token punctuation">"</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StuClass<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t_stu<span class="token punctuation">"</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Student<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>此时，项目目录如下：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>project<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── pom.xml</pre></td></tr><tr><td data-num="3"></td><td><pre>└── src</pre></td></tr><tr><td data-num="4"></td><td><pre>    ├── main</pre></td></tr><tr><td data-num="5"></td><td><pre>    │   ├── <span class="token function">java</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    │   └── resources</pre></td></tr><tr><td data-num="7"></td><td><pre>    │       └── generatorConfig.xml</pre></td></tr><tr><td data-num="8"></td><td><pre>    └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        └── <span class="token function">java</span></pre></td></tr></table></figure><p>然后执行 mybatis-generator 逆向工程插件，生成代码：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>project<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>├── pom.xml</pre></td></tr><tr><td data-num="3"></td><td><pre>└── src</pre></td></tr><tr><td data-num="4"></td><td><pre>    ├── main</pre></td></tr><tr><td data-num="5"></td><td><pre>    │   ├── <span class="token function">java</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    │   │   └── com</pre></td></tr><tr><td data-num="7"></td><td><pre>    │   │       └── example</pre></td></tr><tr><td data-num="8"></td><td><pre>    │   │           └── mybatis</pre></td></tr><tr><td data-num="9"></td><td><pre>    │   │               ├── mapper</pre></td></tr><tr><td data-num="10"></td><td><pre>    │   │               │   ├── StuClassMapper.java</pre></td></tr><tr><td data-num="11"></td><td><pre>    │   │               │   ├── StuClassMapper.xml</pre></td></tr><tr><td data-num="12"></td><td><pre>    │   │               │   ├── StudentMapper.java</pre></td></tr><tr><td data-num="13"></td><td><pre>    │   │               │   └── StudentMapper.xml</pre></td></tr><tr><td data-num="14"></td><td><pre>    │   │               └── pojo</pre></td></tr><tr><td data-num="15"></td><td><pre>    │   │                   ├── StuClassExample.java</pre></td></tr><tr><td data-num="16"></td><td><pre>    │   │                   ├── StuClass.java</pre></td></tr><tr><td data-num="17"></td><td><pre>    │   │                   ├── StudentExample.java</pre></td></tr><tr><td data-num="18"></td><td><pre>    │   │                   └── Student.java</pre></td></tr><tr><td data-num="19"></td><td><pre>    │   └── resources</pre></td></tr><tr><td data-num="20"></td><td><pre>    │       └── generatorConfig.xml</pre></td></tr><tr><td data-num="21"></td><td><pre>    └── <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        └── <span class="token function">java</span></pre></td></tr></table></figure><p>在生成的 pojo 包中，除了 <code>Student</code> 和 <code>StuClass</code> ，还生成了一个 <code>StudentExample</code> 和 <code>StuClassExample</code> ，这两个类中封装的是 MyBatis 的 QBC 查询方法。</p><p>QBC，全称 Query By Criteria，最大的特点是将 SQL 语句中的子句进行组建化封装，使用时可以通过调用 Criteria 对象的方法来进行 SQL 条件的拼接：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 创建 Example 对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token class-name">StudentExample</span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 创建 Criteria 对象并通过 QBC 方式添加查询条件</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token class-name">StudentExample<span class="token punctuation">.</span>Criteria</span> criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  criteria<span class="token punctuation">.</span><span class="token function">andStuAgeBetween</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 通过 example 对象进行查询</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 学习笔记</a> <a href="/tags/MyBatis/" rel="tag"><i class="ic i-tag"></i> MyBatis</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-08-25 00:13:37" itemprop="dateModified" datetime="2023-08-25T00:13:37+08:00">2023-08-25</time> </span><span id="posts/58bb/" class="item leancloud_visitors" data-flag-title="MyBatis 学习笔记" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span>此文章已被阅读次数: </span><span id="twikoo_visitors">正在加载...</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Umi <i class="ic i-at"><em>@</em></i>乌弥的小屋</li><li class="link"><strong>本文链接：</strong> <a href="https://www.umi.homes/posts/58bb/" title="MyBatis 学习笔记">https://www.umi.homes/posts/58bb/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/b34c/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;cdn.staticaly.com&#x2F;gh&#x2F;umitsurumi&#x2F;image-hosting@master&#x2F;cover&#x2F;mysql.18evi7w1lc0w.webp" title="MySQL学习笔记"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 入门笔记</span><h3>MySQL学习笔记</h3></a></div><div class="item right"></div></div><div class="wrap"><div id="tcomments"></div></div><script src="https://cdn.staticfile.org/twikoo/1.6.9/twikoo.all.min.js"></script><script data-pjax>setTimeout(function(){twikoo.init({envId:"https://api.twikoo.umi.homes",el:"#tcomments"})},1e3)</script></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA-maven-%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text">新建 Maven 项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.2.</span> <span class="toc-text">准备测试数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87-java-%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.3.</span> <span class="toc-text">准备 Java 代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.4.</span> <span class="toc-text">准备配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">2.1.5.</span> <span class="toc-text">编写测试类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">单表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql-%E4%BC%A0%E5%8F%82"><span class="toc-number">2.2.1.</span> <span class="toc-text">SQL 传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5"><span class="toc-number">2.2.2.</span> <span class="toc-text">数据输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="toc-number">2.2.3.</span> <span class="toc-text">数据输出</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84%E5%85%B3%E8%81%94"><span class="toc-number">2.3.</span> <span class="toc-text">多表映射关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.3.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%B8%80%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.2.</span> <span class="toc-text">对一的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.3.</span> <span class="toc-text">对多的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.3.4.</span> <span class="toc-text">分步查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">其他配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="toc-number">2.4.1.</span> <span class="toc-text">类型别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">2.4.2.</span> <span class="toc-text">类型处理器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">进阶使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81-sol"><span class="toc-number">3.1.</span> <span class="toc-text">动态 SOL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#if-%E5%92%8C-where-%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.1.</span> <span class="toc-text">if 和 where 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.2.</span> <span class="toc-text">set 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trim-%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.3.</span> <span class="toc-text">trim 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#choosewhenotherwise-%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.4.</span> <span class="toc-text">choose&#x2F;when&#x2F;otherwise 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#foreach-%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.5.</span> <span class="toc-text">foreach 标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">3.2.</span> <span class="toc-text">缓存策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">缓存简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">3.2.2.</span> <span class="toc-text">使用缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ehcache"><span class="toc-number">3.2.3.</span> <span class="toc-text">EHCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.4.</span> <span class="toc-text">缓存原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">3.3.</span> <span class="toc-text">插件机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.4.</span> <span class="toc-text">逆向工程</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/posts/58bb/" rel="bookmark" title="MyBatis学习笔记">MyBatis学习笔记</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Umi" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Umi</p><div class="description" itemprop="description">乌弥的个人博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">34</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">19</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3VtaXRzdXJ1bWk=" title="https:&#x2F;&#x2F;github.com&#x2F;umitsurumi"><i class="ic i-github"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnlvdXJuYW1lQG1haWwuY29t" title="mailto:yourname@mail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-magic"></i>链接</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/favorites/" rel="section"><i class="ic i-star"></i>收藏</a></li></ul></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Umi @ Umi's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">348k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">5:16</span></div><div class="icp"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://icp.gov.moe/?keyword=20221331">萌ICP备20221331</a></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"posts/58bb/",favicon:{show:"（●´3｀●）复活成功",hide:"(´Д｀)浏览器崩溃啦"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!1,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true, theme: 'forest' });</script></body></html><!-- rebuild by hrmmi -->